!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("butterfly-client",[],t):"object"==typeof exports?exports["butterfly-client"]=t():e["butterfly-client"]=t()}(window,function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"ArrayDataEventHandler",{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(t,"VuexArrayGetters",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(t,"VuexArrayHandler",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(t,"VuexArrayMutations",{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(t,"WebSocketChannelClient",{enumerable:!0,get:function(){return a.default}});var r=c(n(1)),o=c(n(2)),i=c(n(3)),u=c(n(4)),a=c(n(5));function c(e){return e&&e.__esModule?e:{default:e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=this,n={};return t.getKeyValue=function(e,t){for(var r="",o=n[e],i=0;i<o.length;i++){var u=t[o[i]];!r&&r.length>0&&(r+=";"),r+=""+u}return r},function(r,o){if("RESET"==r)for(var i in e.arrayMapping){var u=e.arrayMapping[i];u&&u.splice(0,u.length)}else if("DATA-EVENT-TRANSACTION"==r)for(var a=o,c=0;c<a.dataEvents.length;c++){var s=a.dataEvents[c];if("InitialEnd"==s.dataEventType)e.onInitialEnd&&e.onInitialEnd();else{var l=e.arrayMapping[s.name];l?"InitialBegin"==s.dataEventType?(l.splice(0,l.length),n[s.name]=s.keyFieldNames):"Insert"==s.dataEventType||"Initial"==s.dataEventType?function(){var e=t.getKeyValue(s.name,s.record);l.findIndex(function(t){return t._keyValue==e})>=0?console.error("Duplicate key '"+e+"' in table '"+s.name+"'"):(s.record._keyValue=e,l.splice(l.length,0,s.record))}():"Update"==s.dataEventType?function(){var e=t.getKeyValue(s.name,s.record),n=l.findIndex(function(t){return t._keyValue==e});-1==n?console.error("Could not find key '"+e+"' in table '"+s.name+"'"):(s.record._keyValue=e,l.splice(n,1,s.record))}():"Delete"==s.dataEventType&&function(){var e=t.getKeyValue(s.name,s.record),n=l.findIndex(function(t){return t._keyValue==e});l.splice(n,1)}():console.error("No mapping for data event '"+s.name+"'")}}else e.onChannelMessage&&e.onChannelMessage(r,o)}},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t={};return t["".concat(e,"Length")]=function(t){return t[e].length},t["".concat(e,"FindIndex")]=function(t){return function(n){return t[e].findIndex(n)}},t},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return{get length(){return e.getters["".concat(t,"Length")]},findIndex:function(n){return e.getters["".concat(t,"FindIndex")](n)},splice:function(n,r,o){return e.commit("".concat(t,"Splice"),{start:n,deleteCount:r,item:o})}}},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t={};return t["".concat(e,"Splice")]=function(t,n){n.item?t[e].splice(n.start,n.deleteCount,n.item):t[e].splice(n.start,n.deleteCount)},t},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=this,n=e.url;-1==n.indexOf("://")&&(n=("https:"==window.location.protocol?"wss:":"ws:")+"//"+window.location.host+n);console.debug("WebSocketChannelClient():url="+n),t.auth=null,t.subscriptionByChannelKey={},t.setStatus=function(t){r.status!=t&&(r.status=t,e.onStatusChange&&e.onStatusChange(t))},t.testConnection=function(){if(t.webSocket)if(1==t.webSocket.readyState)try{t.webSocket.send("!"),console.debug("WebSocketChannelClient.testConnection():heartbeat success")}catch(e){t.webSocket=null}else t.webSocket=null;else try{t.setStatus("Starting"),t.webSocket=new WebSocket(n),t.webSocket.onmessage=function(e){var n=JSON.parse(e.data);if(n.channelKey){var o=t.subscriptionByChannelKey[n.channelKey];if(o.handlers)for(var i=0;i<o.handlers.length;i++)o.handlers[i](n.messageType,n.data)}else"AUTHENTICATED"==n.messageType?(t.setStatus("Started"),t.markSubscriptionSent(!1),t.sendSubscriptions()):"UNAUTHENTICATED"==n.messageType&&r.stop()},t.webSocket.onopen=function(){t.sendAuthorization()},t.webSocket.onerror=function(e){t.webSocket=null},t.webSocket.onclose=function(){t.webSocket=null}}catch(e){console.debug(e),t.webSocket=null}"Stopped"!=r.status&&(t.testConnectionTimeout=setTimeout(function(){t.testConnection()},e.testConnectionEveryMillis||3e3))},t.sendAuthorization=function(){t.webSocket&&1==t.webSocket.readyState&&t.webSocket.send("Authorization:"+(t.auth||""))},t.sendSubscriptions=function(){if(t.webSocket&&1==t.webSocket.readyState&&"Started"==r.status){var e=[];for(var n in t.subscriptionByChannelKey){var o=t.subscriptionByChannelKey[n];o.sent||e.push({channelKey:n,vars:o.vars})}if(e.length>0){var i="Subscribe:"+JSON.stringify(e);console.debug("WebSocketChannelClient.sendSubscriptions():text="+i),t.webSocket.send(i),t.markSubscriptionSent(!0)}}},t.addSubscription=function(e,n){t.subscriptionByChannelKey[e]=n,t.sendSubscriptions()},t.sendUnsubscribe=function(e){if(t.webSocket&&1==t.webSocket.readyState){var n="Unsubscribe:"+JSON.stringify(e);t.webSocket.send(n)}},t.markSubscriptionSent=function(e){for(var n in t.subscriptionByChannelKey){var r=t.subscriptionByChannelKey[n];r.sent=e}},t.removeSubscription=function(e){delete t.subscriptionByChannelKey[e]};var r={status:null,start:function(e){console.debug("WebSocketChannelClient.start()"),t.auth=e,t.markSubscriptionSent(!1),t.sendAuthorization(),t.testConnection()},subscribe:function(n,r,o){console.debug("WebSocketChannelClient.subscribe():channelKey=".concat(r)),r||(r="default"),t.removeSubscription(r),t.addSubscription(r,{vars:o,handlers:Array.isArray(n)?n:[n],sent:!1}),e.onSubscriptionsUpdated&&e.onSubscriptionsUpdated()},unsubscribe:function(n){console.debug("WebSocketChannelClient.unsubscribe():channelKey=".concat(n)),n||(n="default"),t.removeSubscription(n),t.sendUnsubscribe(n),e.onSubscriptionsUpdated&&e.onSubscriptionsUpdated()},stop:function(){for(var e in console.debug("WebSocketChannelClient.stop()"),t.setStatus("Stopped"),t.webSocket.close(),t.webSocket=null,clearTimeout(t.testConnectionTimeout),t.subscriptionByChannelKey){var n=t.subscriptionByChannelKey[e];if(n.handlers)for(var r=0;r<n.handlers.length;r++)n.handlers[r]("RESET")}}};return r},e.exports=t.default}])});
//# sourceMappingURL=butterfly-client.min.js.map